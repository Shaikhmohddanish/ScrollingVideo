<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scroll-Triggered Sticky Video</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            height: 300vh; /* Increase height to allow scrolling */
            overflow-x: hidden;
        }
        #container {
            position: relative;
            width: 100%;
            height: 500vh; /* Same height as you used in Elementor */
            background-color: black;
        }
        video {
            position: sticky;
            top: 0;
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>

    <div id="container">
        <!-- Video element -->
        <video class="video-background" muted playsinline>
            <source src="https://khankaleem.in/wp-content/uploads/2024/09/MTU-Block-section.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>
    </div>

    <!-- Include GSAP and ScrollTrigger -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.4.0/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.3.3/ScrollTrigger.min.js"></script>

    <script>
    $(document).ready(function() {
        console.clear();
        $('video').addClass('video-background');

        const video = document.querySelector(".video-background");
        let src = video.currentSrc || video.src;
        console.log(video, src);

        // Function to play/pause video on iOS devices
        function once(el, event, fn, opts) {
            var onceFn = function(e) {
                el.removeEventListener(event, onceFn);
                fn.apply(this, arguments);
            };
            el.addEventListener(event, onceFn, opts);
            return onceFn;
        }

        once(document.documentElement, "touchstart", function(e) {
            video.play();
            video.pause();
        });

        // Register GSAP's ScrollTrigger plugin
        gsap.registerPlugin(ScrollTrigger);

        let tl = gsap.timeline({
            defaults: { duration: 1 },
            scrollTrigger: {
                trigger: "#container", // Target the container with the video
                start: "top top",      // Start when the container reaches the top of the viewport
                end: "bottom bottom",  // End when the container leaves the viewport
                scrub: true            // Smooth scrolling effect
            }
        });

        once(video, "loadedmetadata", () => {
            tl.fromTo(
                video,
                { currentTime: 0 },  // Start from the beginning of the video
                { currentTime: video.duration || 6 }  // Play till the end as you scroll
            );
        });

        // Fetch the video to ensure proper playback
        setTimeout(function () {
            if (window["fetch"]) {
                fetch(src)
                    .then((response) => response.blob())
                    .then((response) => {
                        var blobURL = URL.createObjectURL(response);
                        var t = video.currentTime;
                        once(document.documentElement, "touchstart", function(e) {
                            video.play();
                            video.pause();
                        });

                        video.setAttribute("src", blobURL);
                        video.currentTime = t + 0.01;
                    });
            }
        }, 1000);
    });
    </script>

</body>
</html>